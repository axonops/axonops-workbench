/**
 * Module to handle the `app-config.cfg` read and write processes
 * It's also used in the renderer thread
 *
 *
 * Import modules, and define constants
 *
 * Implements a configuration file parser
 * The structure is very similar to the Windows `.ini` file
 */
ConfigParser = require('configparser'),
  // Define `app-config.json` file path
  AppConfigPath = Path.join((extraResourcesPath != null ? Path.join(extraResourcesPath) : Path.join(__dirname, '..', '..')), 'config', 'app-config.cfg')

/**
 * Get the app's configuration properties
 *
 * @Parameters:
 * {object} `callback` function that will be triggered with passing the final configuration object
 *
 * @Return: {object} either `null` or the configuration object
 */
let getConfig = (callback) => {
  try {
    // Add log about this process
    try {
      addLog(`Retrieve the app's configuration from 'app-config.cfg' file`, 'process')
    } catch (e) {}

    // Create a config parser object
    let configObject = new ConfigParser()

    // Read the app configuration file
    configObject.read(AppConfigPath)

    // Call the `callback` function with passing the configuration object
    return callback(configObject)
  } catch (e) {
    try {
      // If the error is a number then don't log the error
      if (!isNaN(parseInt(e.toString())))
        throw 0

      addLog(`Error in process configuration. Details: ${e}`, 'error')
    } catch (e) {}

    // If any error has occurred then call the `callback` function with passing `null` to indicate a failure
    return callback(null)
  }
}

/**
 * Set the given configuration object content in the app's config file
 *
 * @Parameters:
 * {object} `configObject` the configuration object
 */
let setConfig = (configObject) => {
  // Add log about this process
  try {
    addLog(`Write/update the app's configuration to file 'app-config.cfg'`, 'process')
  } catch (e) {}

  // Attempt to set/write the given configuration object in the app's config file
  try {
    configObject.write(AppConfigPath)
  } catch (e) {
    try {
      // If the error is a number then don't log the error
      if (!isNaN(parseInt(e.toString())))
        throw 0

      addLog(`Error in process configuration. Details: ${e}`, 'error')
    } catch (e) {}
  }
}

module.exports = {
  getConfig,
  setConfig
}
