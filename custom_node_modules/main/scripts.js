/**
 * Module to handle scripts actions - mainly the execution - and events
 *
 * Execute a given script in an async way
 *
 * @Parameters:
 * {object} `window` the main view/window object
 * {object} `Terminal` the terminal `node-cmd` object
 * {object} `data` info related to the script meant to be executed:
 * {string} `id`, {string} `scriptPath`
 */
let executeScript = (window, Terminal, data) => {
  // Define the response's ID
  let responseID = `script:result:${data.id}`,
    // Define the command which will be called to execute the script
    command = `"${data.scriptPath}"`

  // On Linux and macOS make sure the script is executable
  if (process.platform != 'win32')
    command = `chmod +x ${command} && sh ${command}`

  // Run the command
  Terminal.run(command, (err, data, stderr) => {
    // Whether or not an error has been found
    let foundError = (err || stderr) != undefined ? true : false

    // Log the error if it has been occurred
    if (foundError)
      try {
        addLog(`Error regards executing script '${data.scriptPath}'. Details: ${err || stderr}`)
      } catch (e) {}

    // Send the result to the renderer thread
    window.webContents.send(responseID, foundError ? -1000 : data)
  })
}

module.exports = {
  executeScript
}
